#include <stdio.h>
#include <unistd.h>
#include <iot_gpio.h>
#include <iot_gpio_ex.h>
#include <iot_spi.h>
#include "oled.h"
#include <base_type.h>

#include "dbg.h"
#include "ohos_init.h"
#include "cmsis_os2.h"

#define OLED_TASK_STACK_SIZE 4096

// width: 100, height: 32
const unsigned char col[]= { 0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfd,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0x1f,0xff,0xff,0xff,0xff,0xfd,0xff,0xf0,0xff,0xff,0xff,0xff,0xfe,0x1f,0xff,0xff,0xff,0xff,0xc1,0xff,0xf0,0xff,0xff,0xff,0xff,0xcf,0xbf,0xff,0xbf,0xfb,0xff,0x81,0xff,0xf0,0xff,0xe0,0x1f,0xff,0xcb,0x7f,0xef,0x9f,0xfb,0xff,0x8b,0xff,0xf0,0xff,0xc0,0x0f,0xff,0xff,0x7f,0xef,0x9f,0xf8,0xff,0xf8,0x7f,0xf0,0xff,0x80,0x07,0xff,0xcd,0x7f,0xe5,0x9f,0xf0,0xff,0xf0,0x3f,0xf0,0xff,0x08,0xc3,0xff,0xce,0x7f,0xc5,0x1f,0xc3,0xff,0x7f,0x7f,0xf0,0xfe,0x0b,0xc3,0xff,0xde,0x3f,0x8d,0x1f,0xc7,0xff,0x7b,0xff,0xf0,0xfe,0x09,0xc3,0xff,0xdc,0x7f,0xdc,0x1f,0xe7,0xff,0x7b,0xff,0xf0,0xfe,0x01,0x83,0xff,0xdf,0x7f,0xd9,0x9f,0xed,0xff,0xfb,0xff,0xf0,0xfe,0x00,0x03,0xff,0xcf,0x4f,0xcb,0x9f,0xec,0xff,0xf0,0x3f,0xf0,0xfe,0x1f,0xe3,0xff,0xcd,0x4f,0xcf,0x9f,0xde,0x7f,0xc1,0x7f,0xf0,0xfe,0x1f,0xc3,0xff,0xd9,0x7f,0xff,0x9f,0x9f,0x3f,0xfb,0xff,0xf0,0xff,0x1d,0xc3,0xff,0xfe,0x7f,0xff,0x9f,0xff,0xff,0xf3,0xff,0xf0,0xff,0x00,0x07,0xff,0xff,0x7f,0xff,0xbf,0xff,0xff,0xe3,0xff,0xf0,0xff,0x80,0x0f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xc0,0x1f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xfb,0xff,0xbf,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0x77,0xeb,0xbb,0xfd,0xbb,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xf0 };
// 张铭 64x32 bitmap
const unsigned char name_bmp[256] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x3E,0x00,0x00,0x7C,0x00,0x00,0x00,
0x00,0x22,0x00,0x00,0x44,0x00,0x00,0x00,
0x7F,0x22,0x7E,0x3F,0x44,0x7E,0x3F,0x00,
0x04,0x22,0x04,0x02,0x44,0x08,0x02,0x00,
0x04,0x22,0x04,0x02,0x44,0x08,0x02,0x00,
0x04,0x22,0x04,0x02,0x44,0x08,0x02,0x00,
0x7F,0x22,0x7F,0x3F,0x44,0x7E,0x3F,0x00,

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x3C,0x00,0x00,0x3E,0x00,0x00,0x00,
0x00,0x24,0x00,0x00,0x22,0x00,0x00,0x00,
0x7F,0x24,0x7E,0x3F,0x22,0x7E,0x3F,0x00,
0x08,0x24,0x08,0x02,0x22,0x08,0x02,0x00,
0x08,0x24,0x08,0x02,0x22,0x08,0x02,0x00,
0x08,0x24,0x08,0x02,0x22,0x08,0x02,0x00,
0x7F,0x3C,0x7F,0x3F,0x3E,0x7E,0x3F,0x00,
};

// 2023192004 128x16 bitmap
const unsigned char id_bmp[256] = {
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 2
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 0
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 2
0x08,0x18,0x28,0x08,0x08,0x3E,0x00,0x00, // 3
0x3E,0x02,0x3E,0x40,0x40,0x3E,0x00,0x00, // 1
0x3C,0x42,0x02,0x1C,0x20,0x7E,0x00,0x00, // 9
0x3C,0x42,0x02,0x1C,0x20,0x7E,0x00,0x00, // 2
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 0
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 0
0x3C,0x42,0x81,0x81,0x42,0x3C,0x00,0x00, // 4

// padding to 256 bytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

void OLedTask(void *para) /* task处理函数 */
{

    // test_led_screen();
    OLED_Init();
    OLED_Clear(0);
    GUI_DrawLine(1, 1, 10, 10, 1);
    GUI_DrawCircle(24, 24, 1, 8);
    sleep(1);
    /*while (1)
    {
        OLED_Clear(0);
        GUI_ShowChinese(0,0,16,"鸿蒙",1);
        GUI_DrawBMP(32, 0, 64, 32, name_bmp, 1);
        GUI_DrawBMP(0, 40, 128, 16, id_bmp, 1);
        //GUI_DrawBMP(20,20,100,32,col,1);
        OLED_Display();
        sleep(1);
    }*/
    while (1)
{
    // 显示中文
    OLED_Clear(0);
    GUI_ShowChinese(32, 16, 32, "张铭", 1);
    OLED_Display();
    sleep(2);

    // 显示数字
    OLED_Clear(0);
    GUI_ShowString(24, 24, (u8 *)"2023192004", 16, 1);
    OLED_Display();
    sleep(2);
}

    OLED_Display();
}

void oled_demo(void)
{
    int ret;
    oled_gpio_io_init();

    IotSpiCfgInitParam init_param = {
        .isSlave = 0};

    // IotSpiCfgBasicInfo cfg_param={
    //      .cpol = IOT_SPI_CFG_CLOCK_CPOL_0,
    //      .cpha = IOT_SPI_CFG_CLOCK_CPHA_0,
    //      .dataWidth = IOT_SPI_CFG_DATA_WIDTH_E_8BIT,
    //      .endian = IOT_SPI_CFG_ENDIAN_LITTLE,
    //      .framMode = IOT_SPI_CFG_FRAM_MODE_MOTOROLA,
    //      .freq = 4000000
    // };

    // IoTSpiInit(0, init_param,&cfg_param);

    screen_spi_master_init(0);
    osThreadAttr_t attr;
    attr.name = "OLedTask";
    attr.attr_bits = 0U;
    attr.cb_mem = NULL;
    attr.cb_size = 0U;
    attr.stack_mem = NULL;
    attr.stack_size = OLED_TASK_STACK_SIZE;
    attr.priority = 20;
    if (osThreadNew((osThreadFunc_t)OLedTask, NULL, &attr) == NULL)
    {
        printf("[OLedExample] Falied to create LedTask1!\n");
    }
}
APP_FEATURE_INIT(oled_demo);
